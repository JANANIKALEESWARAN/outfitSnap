{"ast":null,"code":"import _objectSpread from\"D:/ec/E_Commerence/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useRef,useState}from'react';import{ShopContext}from'./ShopContext';import{jsx as _jsx}from\"react/jsx-runtime\";export const WishlistContext=/*#__PURE__*/createContext(null);const STORAGE_PREFIX='wishlist-items-v1::';const API_BASE=process.env.REACT_APP_API_BASE_URL||'http://localhost:4000';const loadWishlist=storageKey=>{try{const raw=localStorage.getItem(storageKey);if(raw)return JSON.parse(raw);const token=localStorage.getItem('auth-token')||'';const legacyTokenKey=token?\"\".concat(STORAGE_PREFIX).concat(token):'';if(legacyTokenKey){const legacyTokenRaw=localStorage.getItem(legacyTokenKey);if(legacyTokenRaw)return JSON.parse(legacyTokenRaw);}const legacyGlobalKey='wishlist-items-v1';const legacyGlobalRaw=localStorage.getItem(legacyGlobalKey);if(legacyGlobalRaw)return JSON.parse(legacyGlobalRaw);const guestKey=\"\".concat(STORAGE_PREFIX,\"guest\");const guestRaw=localStorage.getItem(guestKey);if(guestRaw)return JSON.parse(guestRaw);return[];}catch(e){return[];}};const WishlistProvider=_ref=>{let{children}=_ref;const{all_product}=useContext(ShopContext);const[userKey,setUserKey]=useState(()=>localStorage.getItem('user-key')||'guest');const storageKey=\"\".concat(STORAGE_PREFIX).concat(userKey);const[wishlist,setWishlist]=useState(()=>loadWishlist(storageKey));const pendingLogRef=useRef(null);useEffect(()=>{const handleUserKeyChange=()=>{setUserKey(localStorage.getItem('user-key')||'guest');};window.addEventListener('focus',handleUserKeyChange);window.addEventListener('storage',handleUserKeyChange);return()=>{window.removeEventListener('focus',handleUserKeyChange);window.removeEventListener('storage',handleUserKeyChange);};},[]);useEffect(()=>{setWishlist(loadWishlist(storageKey));},[storageKey]);useEffect(()=>{try{localStorage.setItem(storageKey,JSON.stringify(wishlist));}catch(_unused){}},[wishlist,storageKey]);useEffect(()=>{if(!pendingLogRef.current)return;const action=pendingLogRef.current;pendingLogRef.current=null;const{productId,intent,metadata}=action;const token=localStorage.getItem('auth-token');const fallback=metadata&&Object.keys(metadata).length?metadata:all_product.find(p=>p.id===productId)||{};const payload={productId,action:intent,productName:fallback.name,category:fallback.category,userKey:localStorage.getItem('user-key')||userKey};fetch(\"\".concat(API_BASE,\"/customer-actions/wishlist\"),{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},token?{'auth-token':token}:{}),body:JSON.stringify(payload)}).catch(err=>{console.warn('Wishlist analytics log failed',err);});},[all_product,userKey,wishlist]);const toggleWishlist=function(id){let metadata=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};setWishlist(prev=>{const exists=prev.includes(id);pendingLogRef.current={productId:id,intent:exists?'remove':'add',metadata};return exists?prev.filter(x=>x!==id):[...prev,id];});};const clearWishlist=()=>setWishlist([]);const isWishlisted=id=>wishlist.includes(id);const count=wishlist.length;const value={wishlist,toggleWishlist,clearWishlist,isWishlisted,count};return/*#__PURE__*/_jsx(WishlistContext.Provider,{value:value,children:children});};export default WishlistProvider;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useRef","useState","ShopContext","jsx","_jsx","WishlistContext","STORAGE_PREFIX","API_BASE","process","env","REACT_APP_API_BASE_URL","loadWishlist","storageKey","raw","localStorage","getItem","JSON","parse","token","legacyTokenKey","concat","legacyTokenRaw","legacyGlobalKey","legacyGlobalRaw","guestKey","guestRaw","e","WishlistProvider","_ref","children","all_product","userKey","setUserKey","wishlist","setWishlist","pendingLogRef","handleUserKeyChange","window","addEventListener","removeEventListener","setItem","stringify","_unused","current","action","productId","intent","metadata","fallback","Object","keys","length","find","p","id","payload","productName","name","category","fetch","method","headers","_objectSpread","body","catch","err","console","warn","toggleWishlist","arguments","undefined","prev","exists","includes","filter","x","clearWishlist","isWishlisted","count","value","Provider"],"sources":["D:/ec/E_Commerence/frontend/src/Context/WishlistContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport { ShopContext } from './ShopContext';\n\nexport const WishlistContext = createContext(null);\nconst STORAGE_PREFIX = 'wishlist-items-v1::';\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || 'http://localhost:4000';\n\nconst loadWishlist = (storageKey) => {\n  try {\n    const raw = localStorage.getItem(storageKey);\n    if (raw) return JSON.parse(raw);\n\n    const token = localStorage.getItem('auth-token') || '';\n    const legacyTokenKey = token ? `${STORAGE_PREFIX}${token}` : '';\n    if (legacyTokenKey) {\n      const legacyTokenRaw = localStorage.getItem(legacyTokenKey);\n      if (legacyTokenRaw) return JSON.parse(legacyTokenRaw);\n    }\n\n    const legacyGlobalKey = 'wishlist-items-v1';\n    const legacyGlobalRaw = localStorage.getItem(legacyGlobalKey);\n    if (legacyGlobalRaw) return JSON.parse(legacyGlobalRaw);\n\n    const guestKey = `${STORAGE_PREFIX}guest`;\n    const guestRaw = localStorage.getItem(guestKey);\n    if (guestRaw) return JSON.parse(guestRaw);\n\n    return [];\n  } catch (e) {\n    return [];\n  }\n};\n\nconst WishlistProvider = ({ children }) => {\n  const { all_product } = useContext(ShopContext);\n  const [userKey, setUserKey] = useState(() => localStorage.getItem('user-key') || 'guest');\n  const storageKey = `${STORAGE_PREFIX}${userKey}`;\n\n  const [wishlist, setWishlist] = useState(() => loadWishlist(storageKey));\n  const pendingLogRef = useRef(null);\n\n  useEffect(() => {\n    const handleUserKeyChange = () => {\n      setUserKey(localStorage.getItem('user-key') || 'guest');\n    };\n    window.addEventListener('focus', handleUserKeyChange);\n    window.addEventListener('storage', handleUserKeyChange);\n    return () => {\n      window.removeEventListener('focus', handleUserKeyChange);\n      window.removeEventListener('storage', handleUserKeyChange);\n    };\n  }, []);\n\n  useEffect(() => {\n    setWishlist(loadWishlist(storageKey));\n  }, [storageKey]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(wishlist));\n    } catch {}\n  }, [wishlist, storageKey]);\n\n  useEffect(() => {\n    if (!pendingLogRef.current) return;\n    const action = pendingLogRef.current;\n    pendingLogRef.current = null;\n    const { productId, intent, metadata } = action;\n    const token = localStorage.getItem('auth-token');\n    const fallback =\n      metadata && Object.keys(metadata).length\n        ? metadata\n        : all_product.find((p) => p.id === productId) || {};\n\n    const payload = {\n      productId,\n      action: intent,\n      productName: fallback.name,\n      category: fallback.category,\n      userKey: localStorage.getItem('user-key') || userKey,\n    };\n\n    fetch(`${API_BASE}/customer-actions/wishlist`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token ? { 'auth-token': token } : {}),\n      },\n      body: JSON.stringify(payload),\n    }).catch((err) => {\n      console.warn('Wishlist analytics log failed', err);\n    });\n  }, [all_product, userKey, wishlist]);\n\n  const toggleWishlist = (id, metadata = {}) => {\n    setWishlist((prev) => {\n      const exists = prev.includes(id);\n      pendingLogRef.current = {\n        productId: id,\n        intent: exists ? 'remove' : 'add',\n        metadata,\n      };\n      return exists ? prev.filter((x) => x !== id) : [...prev, id];\n    });\n  };\n\n  const clearWishlist = () => setWishlist([]);\n  const isWishlisted = (id) => wishlist.includes(id);\n  const count = wishlist.length;\n\n  const value = { wishlist, toggleWishlist, clearWishlist, isWishlisted, count };\n\n  return <WishlistContext.Provider value={value}>{children}</WishlistContext.Provider>;\n};\n\nexport default WishlistProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
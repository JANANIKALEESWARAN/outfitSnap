{"ast":null,"code":"var _jsxFileName = \"D:\\\\ec\\\\E_Commerence\\\\frontend\\\\src\\\\Context\\\\WishlistContext.jsx\",\n  _s = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { ShopContext } from './ShopContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const WishlistContext = /*#__PURE__*/createContext(null);\nconst STORAGE_PREFIX = 'wishlist-items-v1::';\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || 'http://localhost:4000';\nconst loadWishlist = storageKey => {\n  try {\n    const raw = localStorage.getItem(storageKey);\n    if (raw) return JSON.parse(raw);\n    const token = localStorage.getItem('auth-token') || '';\n    const legacyTokenKey = token ? `${STORAGE_PREFIX}${token}` : '';\n    if (legacyTokenKey) {\n      const legacyTokenRaw = localStorage.getItem(legacyTokenKey);\n      if (legacyTokenRaw) return JSON.parse(legacyTokenRaw);\n    }\n    const legacyGlobalKey = 'wishlist-items-v1';\n    const legacyGlobalRaw = localStorage.getItem(legacyGlobalKey);\n    if (legacyGlobalRaw) return JSON.parse(legacyGlobalRaw);\n    const guestKey = `${STORAGE_PREFIX}guest`;\n    const guestRaw = localStorage.getItem(guestKey);\n    if (guestRaw) return JSON.parse(guestRaw);\n    return [];\n  } catch (e) {\n    return [];\n  }\n};\nconst WishlistProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    all_product\n  } = useContext(ShopContext);\n  const [userKey, setUserKey] = useState(() => localStorage.getItem('user-key') || 'guest');\n  const storageKey = `${STORAGE_PREFIX}${userKey}`;\n  const [wishlist, setWishlist] = useState(() => loadWishlist(storageKey));\n  const pendingLogRef = useRef(null);\n  useEffect(() => {\n    const handleUserKeyChange = () => {\n      setUserKey(localStorage.getItem('user-key') || 'guest');\n    };\n    window.addEventListener('focus', handleUserKeyChange);\n    window.addEventListener('storage', handleUserKeyChange);\n    return () => {\n      window.removeEventListener('focus', handleUserKeyChange);\n      window.removeEventListener('storage', handleUserKeyChange);\n    };\n  }, []);\n  useEffect(() => {\n    setWishlist(loadWishlist(storageKey));\n  }, [storageKey]);\n  useEffect(() => {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(wishlist));\n    } catch {}\n  }, [wishlist, storageKey]);\n  useEffect(() => {\n    if (!pendingLogRef.current) return;\n    const action = pendingLogRef.current;\n    pendingLogRef.current = null;\n    const {\n      productId,\n      intent,\n      metadata\n    } = action;\n    const token = localStorage.getItem('auth-token');\n    const fallback = metadata && Object.keys(metadata).length ? metadata : all_product.find(p => p.id === productId) || {};\n    const payload = {\n      productId,\n      action: intent,\n      productName: fallback.name,\n      category: fallback.category,\n      userKey: localStorage.getItem('user-key') || userKey\n    };\n    fetch(`${API_BASE}/customer-actions/wishlist`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token ? {\n          'auth-token': token\n        } : {})\n      },\n      body: JSON.stringify(payload)\n    }).catch(err => {\n      console.warn('Wishlist analytics log failed', err);\n    });\n  }, [all_product, userKey, wishlist]);\n  const toggleWishlist = (id, metadata = {}) => {\n    setWishlist(prev => {\n      const exists = prev.includes(id);\n      pendingLogRef.current = {\n        productId: id,\n        intent: exists ? 'remove' : 'add',\n        metadata\n      };\n      return exists ? prev.filter(x => x !== id) : [...prev, id];\n    });\n  };\n  const clearWishlist = () => setWishlist([]);\n  const isWishlisted = id => wishlist.includes(id);\n  const count = wishlist.length;\n  const value = useMemo(() => ({\n    wishlist,\n    toggleWishlist,\n    clearWishlist,\n    isWishlisted,\n    count\n  }), [wishlist]);\n  return /*#__PURE__*/_jsxDEV(WishlistContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 10\n  }, this);\n};\n_s(WishlistProvider, \"hg7vOjW1N3onXdexsknqGWvQIMM=\");\n_c = WishlistProvider;\nexport default WishlistProvider;\nvar _c;\n$RefreshReg$(_c, \"WishlistProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useRef","useState","ShopContext","jsxDEV","_jsxDEV","WishlistContext","STORAGE_PREFIX","API_BASE","process","env","REACT_APP_API_BASE_URL","loadWishlist","storageKey","raw","localStorage","getItem","JSON","parse","token","legacyTokenKey","legacyTokenRaw","legacyGlobalKey","legacyGlobalRaw","guestKey","guestRaw","e","WishlistProvider","children","_s","all_product","userKey","setUserKey","wishlist","setWishlist","pendingLogRef","handleUserKeyChange","window","addEventListener","removeEventListener","setItem","stringify","current","action","productId","intent","metadata","fallback","Object","keys","length","find","p","id","payload","productName","name","category","fetch","method","headers","body","catch","err","console","warn","toggleWishlist","prev","exists","includes","filter","x","clearWishlist","isWishlisted","count","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/ec/E_Commerence/frontend/src/Context/WishlistContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { ShopContext } from './ShopContext';\n\nexport const WishlistContext = createContext(null);\nconst STORAGE_PREFIX = 'wishlist-items-v1::';\nconst API_BASE = process.env.REACT_APP_API_BASE_URL || 'http://localhost:4000';\n\nconst loadWishlist = (storageKey) => {\n  try {\n    const raw = localStorage.getItem(storageKey);\n    if (raw) return JSON.parse(raw);\n\n    const token = localStorage.getItem('auth-token') || '';\n    const legacyTokenKey = token ? `${STORAGE_PREFIX}${token}` : '';\n    if (legacyTokenKey) {\n      const legacyTokenRaw = localStorage.getItem(legacyTokenKey);\n      if (legacyTokenRaw) return JSON.parse(legacyTokenRaw);\n    }\n\n    const legacyGlobalKey = 'wishlist-items-v1';\n    const legacyGlobalRaw = localStorage.getItem(legacyGlobalKey);\n    if (legacyGlobalRaw) return JSON.parse(legacyGlobalRaw);\n\n    const guestKey = `${STORAGE_PREFIX}guest`;\n    const guestRaw = localStorage.getItem(guestKey);\n    if (guestRaw) return JSON.parse(guestRaw);\n\n    return [];\n  } catch (e) {\n    return [];\n  }\n};\n\nconst WishlistProvider = ({ children }) => {\n  const { all_product } = useContext(ShopContext);\n  const [userKey, setUserKey] = useState(() => localStorage.getItem('user-key') || 'guest');\n  const storageKey = `${STORAGE_PREFIX}${userKey}`;\n\n  const [wishlist, setWishlist] = useState(() => loadWishlist(storageKey));\n  const pendingLogRef = useRef(null);\n\n  useEffect(() => {\n    const handleUserKeyChange = () => {\n      setUserKey(localStorage.getItem('user-key') || 'guest');\n    };\n    window.addEventListener('focus', handleUserKeyChange);\n    window.addEventListener('storage', handleUserKeyChange);\n    return () => {\n      window.removeEventListener('focus', handleUserKeyChange);\n      window.removeEventListener('storage', handleUserKeyChange);\n    };\n  }, []);\n\n  useEffect(() => {\n    setWishlist(loadWishlist(storageKey));\n  }, [storageKey]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(wishlist));\n    } catch {}\n  }, [wishlist, storageKey]);\n\n  useEffect(() => {\n    if (!pendingLogRef.current) return;\n    const action = pendingLogRef.current;\n    pendingLogRef.current = null;\n    const { productId, intent, metadata } = action;\n    const token = localStorage.getItem('auth-token');\n    const fallback =\n      metadata && Object.keys(metadata).length\n        ? metadata\n        : all_product.find((p) => p.id === productId) || {};\n\n    const payload = {\n      productId,\n      action: intent,\n      productName: fallback.name,\n      category: fallback.category,\n      userKey: localStorage.getItem('user-key') || userKey,\n    };\n\n    fetch(`${API_BASE}/customer-actions/wishlist`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token ? { 'auth-token': token } : {}),\n      },\n      body: JSON.stringify(payload),\n    }).catch((err) => {\n      console.warn('Wishlist analytics log failed', err);\n    });\n  }, [all_product, userKey, wishlist]);\n\n  const toggleWishlist = (id, metadata = {}) => {\n    setWishlist((prev) => {\n      const exists = prev.includes(id);\n      pendingLogRef.current = {\n        productId: id,\n        intent: exists ? 'remove' : 'add',\n        metadata,\n      };\n      return exists ? prev.filter((x) => x !== id) : [...prev, id];\n    });\n  };\n\n  const clearWishlist = () => setWishlist([]);\n  const isWishlisted = (id) => wishlist.includes(id);\n  const count = wishlist.length;\n\n  const value = useMemo(\n    () => ({ wishlist, toggleWishlist, clearWishlist, isWishlisted, count }),\n    [wishlist]\n  );\n\n  return <WishlistContext.Provider value={value}>{children}</WishlistContext.Provider>;\n};\n\nexport default WishlistProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
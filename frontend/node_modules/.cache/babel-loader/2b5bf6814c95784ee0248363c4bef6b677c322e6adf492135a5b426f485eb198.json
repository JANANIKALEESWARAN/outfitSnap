{"ast":null,"code":"import _objectSpread from\"D:/ec/E_Commerence/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from\"react\";import\"./VirtualTryOn.css\";/*\n  VirtualTryOn component\n  - User can upload a photo or use camera\n  - Product image is overlaid on top with controls (move/scale/rotate)\n  - Download the composed image\n  - Reuses parent add-to-cart logic via onAddToCart prop\n*/import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const constraints={video:{width:640,height:480},audio:false};export const VirtualTryOn=_ref=>{let{productImage,productMaskImage,productName,onAddToCart,isLoggedIn}=_ref;const[mode,setMode]=useState(\"upload\");// 'upload' | 'camera'\nconst[bgImage,setBgImage]=useState(null);// Image element for user's photo\nconst[overlay,setOverlay]=useState({scale:1,scaleY:1,shearY:0,warp:0.15,rotation:0,x:0,y:0,neckX:null,neckY:null,shoulderW:null});const[canvasSize,setCanvasSize]=useState({width:640,height:480});const[poseReady,setPoseReady]=useState(false);const[segReady,setSegReady]=useState(false);const[handsReady,setHandsReady]=useState(false);const[enableOcclusion,setEnableOcclusion]=useState(true);const[autoRemoveBg,setAutoRemoveBg]=useState(true);const[showGuides,setShowGuides]=useState(false);const[userHeightCm,setUserHeightCm]=useState(170);const videoRef=useRef(null);const streamRef=useRef(null);const canvasRef=useRef(null);const productImgRef=useRef(null);const maskImgRef=useRef(null);const garmentCanvasRef=useRef(null);// cached masked garment\nconst poseRef=useRef(null);const segRef=useRef(null);const handsRef=useRef(null);const rafRef=useRef(null);// Build masked garment canvas from product image and optional mask\nconst prepareGarmentBitmap=()=>{try{const img=productImgRef.current;if(!img||!img.naturalWidth)return;const w=img.naturalWidth,h=img.naturalHeight;const gc=document.createElement('canvas');gc.width=w;gc.height=h;const gctx=gc.getContext('2d');gctx.drawImage(img,0,0);// If we have a precomputed mask image, apply it\nconst maskImg=maskImgRef.current;if(maskImg&&maskImg.naturalWidth){gctx.globalCompositeOperation='destination-in';gctx.drawImage(maskImg,0,0,w,h);gctx.globalCompositeOperation='source-over';garmentCanvasRef.current=gc;return;}// Auto-generate mask by sampling corner background and thresholding\nconst imgData=gctx.getImageData(0,0,w,h);const d=imgData.data;const sample=(x,y)=>{const i=(y*w+x)*4;return[d[i],d[i+1],d[i+2]];};const corners=[sample(2,2),sample(w-3,2),sample(2,h-3),sample(w-3,h-3)];const avg=corners.reduce((a,c)=>[a[0]+c[0],a[1]+c[1],a[2]+c[2]],[0,0,0]).map(v=>v/4);const dist=(r,g,b)=>Math.hypot(r-avg[0],g-avg[1],b-avg[2]);const T=40;for(let i=0;i<d.length;i+=4){const r=d[i],g=d[i+1],b=d[i+2];const nearBg=dist(r,g,b)<T||r>240&&g>240&&b>240;if(nearBg)d[i+3]=0;}const aCopy=new Uint8ClampedArray(d);const idx=(x,y)=>(y*w+x)*4+3;for(let y=1;y<h-1;y++){for(let x=1;x<w-1;x++){const a=aCopy[idx(x,y)];if(a===0)continue;let hole=0;if(aCopy[idx(x-1,y)]===0)hole++;if(aCopy[idx(x+1,y)]===0)hole++;if(aCopy[idx(x,y-1)]===0)hole++;if(aCopy[idx(x,y+1)]===0)hole++;if(hole>0)d[idx(x,y)]=Math.min(200,a);}}gctx.putImageData(imgData,0,0);garmentCanvasRef.current=gc;}catch(e){}};// Auto fit garment using pose landmarks\nconst autoFit=async()=>{try{if(!poseRef.current)return;const canvas=document.createElement(\"canvas\");canvas.width=canvasSize.width;canvas.height=canvasSize.height;const ctx=canvas.getContext(\"2d\");if(bgImage){// draw with aspect preserved like render loop\nconst scale=Math.min(canvas.width/bgImage.width,canvas.height/bgImage.height);const drawW=bgImage.width*scale;const drawH=bgImage.height*scale;const offsetX=(canvas.width-drawW)/2;const offsetY=(canvas.height-drawH)/2;ctx.drawImage(bgImage,offsetX,offsetY,drawW,drawH);}else if(mode===\"camera\"&&videoRef.current){ctx.drawImage(videoRef.current,0,0,canvas.width,canvas.height);}else{alert('No image available to detect. Upload or capture a photo.');return;}const p=poseRef.current;let landmarks=null;await new Promise(resolve=>{p.onResults(res=>{landmarks=res.poseLandmarks;resolve();});p.send({image:canvas});});if(!landmarks||landmarks.length<25){alert('Could not detect body landmarks. Try another photo facing camera.');return;}const L=landmarks;const w=canvas.width,h=canvas.height;let ls=L[11],rs=L[12];// Fallback: estimate shoulders from ears if needed\nif((!ls||!rs)&&L[7]&&L[8]){const le=L[7],re=L[8];const ex1=(le.x||0)*w,ey1=(le.y||0)*h;const ex2=(re.x||0)*w,ey2=(re.y||0)*h;const earW=Math.hypot(ex1-ex2,ey1-ey2);const midx=(ex1+ex2)/2,midy=(ey1+ey2)/2+earW*0.9;// move down from ears to approx shoulders\nls={x:(midx-earW*0.9)/w,y:midy/h};rs={x:(midx+earW*0.9)/w,y:midy/h};}if(!ls||!rs){alert('Shoulders not found. Ensure your shoulders are visible.');return;}const sx=(ls.x||0)*w,sy=(ls.y||0)*h;const rx=(rs.x||0)*w,ry=(rs.y||0)*h;const mx=(sx+rx)/2,my=(sy+ry)/2;const shoulderW=Math.max(10,Math.hypot(sx-rx,sy-ry));const base=Math.min(w,h)*0.6;const desiredOverlayW=shoulderW*1.8;const scale=Math.max(0.3,Math.min(1.8,desiredOverlayW/Math.max(base,1)));const angleDeg=Math.atan2(ry-sy,rx-sx)*180/Math.PI;let torsoLen=shoulderW*1.2;const lh=L[23],rh=L[24];if(lh&&rh){const hx=((lh.x||0)+(rh.x||0))/2*w;const hy=((lh.y||0)+(rh.y||0))/2*h;torsoLen=Math.max(shoulderW*0.8,Math.hypot(mx-hx,my-hy));}const scaleY=Math.max(0.8,Math.min(1.6,torsoLen/Math.max(shoulderW,1)));// shearY based on shoulder vertical difference before rotation\nconst shoulderDy=ry-sy;const shearY=Math.max(-0.3,Math.min(0.3,shoulderDy/Math.max(shoulderW,1)*0.8));const cx=w/2,cy=h/2;// Estimate neck Y using nose and ears\nconst nose=L[0];let neckY=my;// fallback: shoulder mid\nif(nose){const noseY=(nose.y||0)*h;neckY=Math.min(my-shoulderW*0.15,noseY+shoulderW*0.35);}// convert neck target to overlay offset relative to canvas center\nconst targetY=neckY;// place garment so collar sits near neck target (heuristic offset)\nconst yOffset=my-targetY+shoulderW*0.5;setOverlay(o=>_objectSpread(_objectSpread({},o),{},{x:Math.round(mx-cx),y:Math.round(my-cy-yOffset),scale,scaleY,shearY,rotation:Math.round(angleDeg),neckX:mx,neckY:neckY,shoulderW}));}catch(e){}};// Camera handling\nuseEffect(()=>{const startCamera=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia(constraints);streamRef.current=stream;if(videoRef.current){videoRef.current.srcObject=stream;await videoRef.current.play();}setCanvasSize({width:constraints.video.width,height:constraints.video.height});}catch(err){console.error(\"Camera error:\",err);alert(\"Unable to access camera. Please allow permission or use Upload mode.\");setMode(\"upload\");}};const stopCamera=()=>{if(streamRef.current){streamRef.current.getTracks().forEach(t=>t.stop());streamRef.current=null;}};if(mode===\"camera\")startCamera();else stopCamera();return()=>stopCamera();},[mode]);useEffect(()=>{if(window.Pose||window.pose)return;const s=document.createElement(\"script\");s.src=\"https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js\";s.async=true;s.onload=()=>{try{const Pose=window.Pose||window.pose;if(!Pose||!Pose.Pose)return;const p=new Pose.Pose({locateFile:file=>\"https://cdn.jsdelivr.net/npm/@mediapipe/pose/\".concat(file)});p.setOptions({modelComplexity:0,selfieMode:true,smoothLandmarks:true,enableSegmentation:false});poseRef.current=p;setPoseReady(true);}catch(e){}};document.body.appendChild(s);},[]);// Load MediaPipe Hands to reinforce occlusion for hands/arms\nuseEffect(()=>{if(window.Hands||window.hands)return;const s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js';s.async=true;s.onload=()=>{try{const Hands=window.Hands||window.hands;if(!Hands||!Hands.Hands)return;const h=new Hands.Hands({locateFile:file=>\"https://cdn.jsdelivr.net/npm/@mediapipe/hands/\".concat(file)});h.setOptions({selfieMode:true,maxNumHands:2,modelComplexity:1,minDetectionConfidence:0.5,minTrackingConfidence:0.5});handsRef.current=h;setHandsReady(true);}catch(e){}};document.body.appendChild(s);},[]);useEffect(()=>{if(window.SelfieSegmentation||window.selfieSegmentation)return;const s=document.createElement(\"script\");s.src=\"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js\";s.async=true;s.onload=()=>{try{const SS=window.SelfieSegmentation||window.selfieSegmentation;if(!SS||!SS.SelfieSegmentation)return;const seg=new SS.SelfieSegmentation({locateFile:file=>\"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/\".concat(file)});seg.setOptions({modelSelection:1});// landscape general\nsegRef.current=seg;setSegReady(true);setEnableOcclusion(true);}catch(e){}};document.body.appendChild(s);},[]);// File upload -> load as Image\nconst onFileChange=e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(!file)return;const reader=new FileReader();reader.onload=()=>{const img=new Image();img.onload=()=>{setBgImage(img);const maxW=800,maxH=800;let w=img.width,h=img.height;const ratio=Math.min(maxW/w,maxH/h,1);setCanvasSize({width:Math.round(w*ratio),height:Math.round(h*ratio)});};img.src=reader.result;};reader.readAsDataURL(file);};// Capture from camera\nconst captureFromCamera=()=>{if(!videoRef.current)return;const{videoWidth:w,videoHeight:h}=videoRef.current;setCanvasSize({width:w,height:h});const temp=document.createElement(\"canvas\");temp.width=w;temp.height=h;const ctx=temp.getContext(\"2d\");ctx.drawImage(videoRef.current,0,0,w,h);const img=new Image();img.onload=()=>setBgImage(img);img.src=temp.toDataURL(\"image/png\");};// Draw composition with rAF and optional occlusion\nuseEffect(()=>{const{width,height}=canvasSize;// for lint dependency clarity\nconst draw=async()=>{const canvas=canvasRef.current;const ctx=canvas===null||canvas===void 0?void 0:canvas.getContext(\"2d\");if(!canvas||!ctx)return;ctx.clearRect(0,0,canvas.width,canvas.height);// 1) capture background frame\nlet frameCanvas=document.createElement(\"canvas\");frameCanvas.width=canvas.width;frameCanvas.height=canvas.height;const fctx=frameCanvas.getContext(\"2d\");if(bgImage){const scale=Math.min(canvas.width/bgImage.width,canvas.height/bgImage.height);const drawW=bgImage.width*scale;const drawH=bgImage.height*scale;const offsetX=(canvas.width-drawW)/2;const offsetY=(canvas.height-drawH)/2;fctx.drawImage(bgImage,offsetX,offsetY,drawW,drawH);ctx.drawImage(frameCanvas,0,0);}else if(mode===\"camera\"&&videoRef.current&&!videoRef.current.paused){fctx.drawImage(videoRef.current,0,0,canvas.width,canvas.height);ctx.drawImage(frameCanvas,0,0);}else{ctx.fillStyle=\"#f5f5f5\";ctx.fillRect(0,0,canvas.width,canvas.height);}// 2) draw garment overlay (use prepared garment canvas)\nconst productImg=productImgRef.current;if(productImg){let garment=garmentCanvasRef.current||productImg;const baseSize=Math.min(canvas.width,canvas.height)*0.6;const overlayW=baseSize*(overlay.scale||1);const aspect=(garment.height||productImg.naturalHeight)/Math.max(garment.width||productImg.naturalWidth,1);const overlayH=overlayW*aspect;const centerX=canvas.width/2+overlay.x;const centerY=canvas.height/2+overlay.y;ctx.save();ctx.translate(centerX,centerY);ctx.rotate(overlay.rotation*Math.PI/180);// non-uniform scale and shear to approximate warping\nconst sy=overlay.scaleY||1;const shy=overlay.shearY||0;// shear on Y axis\nconst warp=overlay.warp||0;// additional piecewise vertical scaling\nctx.transform(1,shy,0,sy,0,0);if(warp>0){const slices=24;const srcH=overlayH;for(let i=0;i<slices;i++){const t0=i/slices;// 0..1 top->bottom\nconst t1=(i+1)/slices;const ty=(t0+t1)/2-0.5;// -0.5..0.5 center\nconst localScale=1+warp*(Math.abs(ty)*2-0.5);// slightly more scale at chest/hip\nconst sh=srcH/slices*localScale;const sy0=-overlayH/2+t0*overlayH;const srcY=t0*garment.height;const srcSliceH=garment.height/slices;ctx.drawImage(garment,0,srcY,garment.width,srcSliceH,-overlayW/2,sy0,overlayW,sh);}}else{ctx.drawImage(garment,-overlayW/2,-overlayH/2,overlayW,overlayH);}// carve a small neck opening so collar doesn't overlay the neck\nif(overlay.neckX!=null&&overlay.neckY!=null&&overlay.shoulderW){ctx.globalCompositeOperation='destination-out';const neckLocalX=overlay.neckX-(canvas.width/2+overlay.x);const neckLocalY=overlay.neckY-(canvas.height/2+overlay.y);const rx=Math.max(6,overlay.shoulderW*0.22);const ry=Math.max(4,overlay.shoulderW*0.16);ctx.beginPath();ctx.ellipse(neckLocalX,neckLocalY,rx,ry,0,0,Math.PI*2);ctx.fill();ctx.globalCompositeOperation='source-over';}ctx.restore();}// Optional guides\nif(showGuides){ctx.strokeStyle='rgba(0,0,0,0.2)';ctx.beginPath();ctx.moveTo(canvas.width/2,0);ctx.lineTo(canvas.width/2,canvas.height);ctx.stroke();ctx.beginPath();ctx.moveTo(0,canvas.height/2);ctx.lineTo(canvas.width,canvas.height/2);ctx.stroke();}// 3) occlusion: draw person foreground on top using mask\nif(enableOcclusion&&segRef.current&&(bgImage||mode==='camera')){const seg=segRef.current;let maskImg=null;await new Promise(resolve=>{seg.onResults(res=>{maskImg=res.segmentationMask;resolve();});seg.send({image:frameCanvas});});if(maskImg){const personCanvas=document.createElement('canvas');personCanvas.width=canvas.width;personCanvas.height=canvas.height;const pc=personCanvas.getContext('2d');// Grow the mask a bit and blur for softer edges around hands/arms\nconst maskCanvas=document.createElement('canvas');maskCanvas.width=canvas.width;maskCanvas.height=canvas.height;const mc=maskCanvas.getContext('2d');mc.drawImage(maskImg,0,0,canvas.width,canvas.height);// If hands model is ready, paint convex hulls of hands onto the mask\nif(handsRef.current){const hands=handsRef.current;let handsData=null;await new Promise(resolve=>{hands.onResults(res=>{handsData=res.multiHandLandmarks||[];resolve();});hands.send({image:frameCanvas});});if(handsData&&handsData.length){mc.fillStyle='#fff';mc.globalAlpha=1.0;handsData.forEach(points=>{if(!points||points.length===0)return;mc.beginPath();const scaleX=canvas.width,scaleY=canvas.height;points.forEach((p,i)=>{const x=p.x*scaleX,y=p.y*scaleY;if(i===0)mc.moveTo(x,y);else mc.lineTo(x,y);});mc.closePath();mc.fill();});}}// simple dilation by drawing shifted copies\nconst expanded=document.createElement('canvas');expanded.width=canvas.width;expanded.height=canvas.height;const ex=expanded.getContext('2d');for(const[dx,dy]of[[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]){ex.drawImage(maskCanvas,dx,dy);}ex.filter='blur(2px)';ex.drawImage(expanded,0,0);pc.drawImage(frameCanvas,0,0);pc.globalCompositeOperation='destination-in';pc.drawImage(expanded,0,0);pc.globalCompositeOperation='source-over';ctx.drawImage(personCanvas,0,0);}}};const loop=()=>{if(mode==='camera'){draw();rafRef.current=requestAnimationFrame(loop);}else{draw();}};loop();return()=>{if(rafRef.current)cancelAnimationFrame(rafRef.current);};},[bgImage,mode,overlay,canvasSize.width,canvasSize.height,enableOcclusion,autoRemoveBg,showGuides]);// Live refresh in camera mode\nuseEffect(()=>{if(mode!==\"camera\")return;const id=setInterval(()=>{const canvas=canvasRef.current;const ctx=canvas===null||canvas===void 0?void 0:canvas.getContext(\"2d\");if(!canvas||!ctx)return;// redraw\nconst productImg=productImgRef.current;ctx.clearRect(0,0,canvas.width,canvas.height);if(videoRef.current){ctx.drawImage(videoRef.current,0,0,canvas.width,canvas.height);if(productImg){const baseSize=Math.min(canvas.width,canvas.height)*0.6;const overlayW=baseSize*overlay.scale;const overlayH=overlayW*(productImg.naturalHeight/Math.max(productImg.naturalWidth,1));const centerX=canvas.width/2+overlay.x;const centerY=canvas.height/2+overlay.y;ctx.save();ctx.translate(centerX,centerY);ctx.rotate(overlay.rotation*Math.PI/180);ctx.drawImage(productImg,-overlayW/2,-overlayH/2,overlayW,overlayH);ctx.restore();}}},100);return()=>clearInterval(id);},[mode,overlay]);const downloadImage=()=>{try{const link=document.createElement(\"a\");link.download=\"\".concat(productName||\"product\",\"-tryon.png\");link.href=canvasRef.current.toDataURL(\"image/png\");link.click();}catch(err){console.error(\"Download failed:\",err);alert(\"Download failed. If product images come from a different domain, enable CORS or use same-origin images.\");}};const handleAddToCart=()=>{if(!onAddToCart)return;if(isLoggedIn)onAddToCart();else alert(\"Please login to add items to cart.\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"vto\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Virtual Try-On\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"vto-mode\",children:[/*#__PURE__*/_jsx(\"button\",{className:mode===\"upload\"?\"active\":\"\",onClick:()=>setMode(\"upload\"),children:\"Upload Photo\"}),/*#__PURE__*/_jsx(\"button\",{className:mode===\"camera\"?\"active\":\"\",onClick:()=>setMode(\"camera\"),children:\"Use Camera\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"vto-stage\",children:[/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,width:canvasSize.width,height:canvasSize.height,className:\"vto-canvas\"}),/*#__PURE__*/_jsx(\"img\",{ref:productImgRef,src:productImage,alt:productName,crossOrigin:\"anonymous\",style:{display:\"none\"},onLoad:()=>{prepareGarmentBitmap();setOverlay(o=>_objectSpread({},o));}}),productMaskImage?/*#__PURE__*/_jsx(\"img\",{ref:maskImgRef,src:productMaskImage,alt:\"mask\",crossOrigin:\"anonymous\",style:{display:\"none\"},onLoad:()=>{prepareGarmentBitmap();setOverlay(o=>_objectSpread({},o));}}):null]}),mode===\"upload\"&&/*#__PURE__*/_jsx(\"div\",{className:\"vto-upload\",children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:onFileChange})}),mode===\"camera\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"vto-camera\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,className:\"vto-video\",playsInline:true,muted:true}),/*#__PURE__*/_jsx(\"button\",{onClick:captureFromCamera,children:\"Capture Photo\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"vto-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Position X\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:-canvasSize.width/2,max:canvasSize.width/2,value:overlay.x,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{x:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Position Y\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:-canvasSize.height/2,max:canvasSize.height/2,value:overlay.y,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{y:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Scale\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:0.2,max:2,step:0.01,value:overlay.scale,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{scale:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Stretch Y\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:0.6,max:1.8,step:0.01,value:overlay.scaleY,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{scaleY:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Warp\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:0,max:0.4,step:0.005,value:overlay.warp,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{warp:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Rotation\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:-180,max:180,value:overlay.rotation,onChange:e=>setOverlay(_objectSpread(_objectSpread({},overlay),{},{rotation:Number(e.target.value)}))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ctrl\",children:/*#__PURE__*/_jsx(\"button\",{disabled:!poseReady,onClick:autoFit,children:\"Auto Fit\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ctrl\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",disabled:!segReady,checked:enableOcclusion&&segReady,onChange:e=>setEnableOcclusion(e.target.checked)}),\"Occlusion \",segReady?'':'(loading...)']})}),/*#__PURE__*/_jsx(\"div\",{className:\"ctrl\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:autoRemoveBg,onChange:e=>setAutoRemoveBg(e.target.checked)}),\" Remove garment bg\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"ctrl\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showGuides,onChange:e=>setShowGuides(e.target.checked)}),\" Show guides\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ctrl\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"User height (cm)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:userHeightCm,onChange:e=>setUserHeightCm(Number(e.target.value)||170),style:{width:100}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"vto-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:downloadImage,children:\"Download Result\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn primary\",onClick:handleAddToCart,children:\"Add To Cart\"})]})]});};export default VirtualTryOn;","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","jsxs","_jsxs","constraints","video","width","height","audio","VirtualTryOn","_ref","productImage","productMaskImage","productName","onAddToCart","isLoggedIn","mode","setMode","bgImage","setBgImage","overlay","setOverlay","scale","scaleY","shearY","warp","rotation","x","y","neckX","neckY","shoulderW","canvasSize","setCanvasSize","poseReady","setPoseReady","segReady","setSegReady","handsReady","setHandsReady","enableOcclusion","setEnableOcclusion","autoRemoveBg","setAutoRemoveBg","showGuides","setShowGuides","userHeightCm","setUserHeightCm","videoRef","streamRef","canvasRef","productImgRef","maskImgRef","garmentCanvasRef","poseRef","segRef","handsRef","rafRef","prepareGarmentBitmap","img","current","naturalWidth","w","h","naturalHeight","gc","document","createElement","gctx","getContext","drawImage","maskImg","globalCompositeOperation","imgData","getImageData","d","data","sample","i","corners","avg","reduce","a","c","map","v","dist","r","g","b","Math","hypot","T","length","nearBg","aCopy","Uint8ClampedArray","idx","hole","min","putImageData","e","autoFit","canvas","ctx","drawW","drawH","offsetX","offsetY","alert","p","landmarks","Promise","resolve","onResults","res","poseLandmarks","send","image","L","ls","rs","le","re","ex1","ey1","ex2","ey2","earW","midx","midy","sx","sy","rx","ry","mx","my","max","base","desiredOverlayW","angleDeg","atan2","PI","torsoLen","lh","rh","hx","hy","shoulderDy","cx","cy","nose","noseY","targetY","yOffset","o","_objectSpread","round","startCamera","stream","navigator","mediaDevices","getUserMedia","srcObject","play","err","console","error","stopCamera","getTracks","forEach","t","stop","window","Pose","pose","s","src","async","onload","locateFile","file","concat","setOptions","modelComplexity","selfieMode","smoothLandmarks","enableSegmentation","body","appendChild","Hands","hands","maxNumHands","minDetectionConfidence","minTrackingConfidence","SelfieSegmentation","selfieSegmentation","SS","seg","modelSelection","onFileChange","_e$target$files","target","files","reader","FileReader","Image","maxW","maxH","ratio","result","readAsDataURL","captureFromCamera","videoWidth","videoHeight","temp","toDataURL","draw","clearRect","frameCanvas","fctx","paused","fillStyle","fillRect","productImg","garment","baseSize","overlayW","aspect","overlayH","centerX","centerY","save","translate","rotate","shy","transform","slices","srcH","t0","t1","ty","localScale","abs","sh","sy0","srcY","srcSliceH","neckLocalX","neckLocalY","beginPath","ellipse","fill","restore","strokeStyle","moveTo","lineTo","stroke","segmentationMask","personCanvas","pc","maskCanvas","mc","handsData","multiHandLandmarks","globalAlpha","points","scaleX","closePath","expanded","ex","dx","dy","filter","loop","requestAnimationFrame","cancelAnimationFrame","id","setInterval","clearInterval","downloadImage","link","download","href","click","handleAddToCart","className","children","onClick","ref","alt","crossOrigin","style","display","onLoad","type","accept","onChange","playsInline","muted","value","Number","step","disabled","checked"],"sources":["D:/ec/E_Commerence/frontend/src/Components/VirtualTryOn/VirtualTryOn.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport \"./VirtualTryOn.css\";\n\n/*\n  VirtualTryOn component\n  - User can upload a photo or use camera\n  - Product image is overlaid on top with controls (move/scale/rotate)\n  - Download the composed image\n  - Reuses parent add-to-cart logic via onAddToCart prop\n*/\n\nconst constraints = { video: { width: 640, height: 480 }, audio: false };\n\nexport const VirtualTryOn = ({ productImage, productMaskImage, productName, onAddToCart, isLoggedIn }) => {\n  const [mode, setMode] = useState(\"upload\"); // 'upload' | 'camera'\n  const [bgImage, setBgImage] = useState(null); // Image element for user's photo\n  const [overlay, setOverlay] = useState({ scale: 1, scaleY: 1, shearY: 0, warp: 0.15, rotation: 0, x: 0, y: 0, neckX: null, neckY: null, shoulderW: null });\n  const [canvasSize, setCanvasSize] = useState({ width: 640, height: 480 });\n  const [poseReady, setPoseReady] = useState(false);\n  const [segReady, setSegReady] = useState(false);\n  const [handsReady, setHandsReady] = useState(false);\n  const [enableOcclusion, setEnableOcclusion] = useState(true);\n  const [autoRemoveBg, setAutoRemoveBg] = useState(true);\n  const [showGuides, setShowGuides] = useState(false);\n  const [userHeightCm, setUserHeightCm] = useState(170);\n\n  const videoRef = useRef(null);\n  const streamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const productImgRef = useRef(null);\n  const maskImgRef = useRef(null);\n  const garmentCanvasRef = useRef(null); // cached masked garment\n  const poseRef = useRef(null);\n  const segRef = useRef(null);\n  const handsRef = useRef(null);\n  const rafRef = useRef(null);\n\n  // Build masked garment canvas from product image and optional mask\n  const prepareGarmentBitmap = () => {\n    try {\n      const img = productImgRef.current;\n      if (!img || !img.naturalWidth) return;\n      const w = img.naturalWidth, h = img.naturalHeight;\n      const gc = document.createElement('canvas');\n      gc.width = w; gc.height = h;\n      const gctx = gc.getContext('2d');\n      gctx.drawImage(img, 0, 0);\n\n      // If we have a precomputed mask image, apply it\n      const maskImg = maskImgRef.current;\n      if (maskImg && maskImg.naturalWidth) {\n        gctx.globalCompositeOperation = 'destination-in';\n        gctx.drawImage(maskImg, 0, 0, w, h);\n        gctx.globalCompositeOperation = 'source-over';\n        garmentCanvasRef.current = gc;\n        return;\n      }\n\n      // Auto-generate mask by sampling corner background and thresholding\n      const imgData = gctx.getImageData(0, 0, w, h);\n      const d = imgData.data;\n      const sample = (x, y) => { const i = (y * w + x) * 4; return [d[i], d[i+1], d[i+2]]; };\n      const corners = [ sample(2, 2), sample(w-3, 2), sample(2, h-3), sample(w-3, h-3) ];\n      const avg = corners.reduce((a,c)=>[a[0]+c[0],a[1]+c[1],a[2]+c[2]],[0,0,0]).map(v=>v/4);\n      const dist = (r,g,b)=> Math.hypot(r-avg[0], g-avg[1], b-avg[2]);\n      const T = 40;\n      for (let i=0;i<d.length;i+=4){\n        const r=d[i], g=d[i+1], b=d[i+2];\n        const nearBg = dist(r,g,b) < T || (r>240&&g>240&&b>240);\n        if (nearBg) d[i+3] = 0;\n      }\n      const aCopy = new Uint8ClampedArray(d);\n      const idx = (x,y)=> (y*w+x)*4 + 3;\n      for (let y=1;y<h-1;y++){\n        for (let x=1;x<w-1;x++){\n          const a = aCopy[idx(x,y)];\n          if (a===0) continue;\n          let hole = 0;\n          if (aCopy[idx(x-1,y)]===0) hole++;\n          if (aCopy[idx(x+1,y)]===0) hole++;\n          if (aCopy[idx(x,y-1)]===0) hole++;\n          if (aCopy[idx(x,y+1)]===0) hole++;\n          if (hole>0) d[idx(x,y)] = Math.min(200, a);\n        }\n      }\n      gctx.putImageData(imgData,0,0);\n      garmentCanvasRef.current = gc;\n    } catch (e) {}\n  };\n\n  // Auto fit garment using pose landmarks\n  const autoFit = async () => {\n    try {\n      if (!poseRef.current) return;\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = canvasSize.width; canvas.height = canvasSize.height;\n      const ctx = canvas.getContext(\"2d\");\n      if (bgImage) {\n        // draw with aspect preserved like render loop\n        const scale = Math.min(canvas.width / bgImage.width, canvas.height / bgImage.height);\n        const drawW = bgImage.width * scale;\n        const drawH = bgImage.height * scale;\n        const offsetX = (canvas.width - drawW) / 2;\n        const offsetY = (canvas.height - drawH) / 2;\n        ctx.drawImage(bgImage, offsetX, offsetY, drawW, drawH);\n      } else if (mode === \"camera\" && videoRef.current) {\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\n      } else {\n        alert('No image available to detect. Upload or capture a photo.');\n        return;\n      }\n      const p = poseRef.current;\n      let landmarks = null;\n      await new Promise((resolve) => {\n        p.onResults((res) => { landmarks = res.poseLandmarks; resolve(); });\n        p.send({ image: canvas });\n      });\n      if (!landmarks || landmarks.length < 25) { alert('Could not detect body landmarks. Try another photo facing camera.'); return; }\n      const L = landmarks;\n      const w = canvas.width, h = canvas.height;\n      let ls = L[11], rs = L[12];\n      // Fallback: estimate shoulders from ears if needed\n      if ((!ls || !rs) && L[7] && L[8]) {\n        const le = L[7], re = L[8];\n        const ex1 = (le.x||0)*w, ey1=(le.y||0)*h;\n        const ex2 = (re.x||0)*w, ey2=(re.y||0)*h;\n        const earW = Math.hypot(ex1-ex2, ey1-ey2);\n        const midx = (ex1+ex2)/2, midy=(ey1+ey2)/2 + earW*0.9; // move down from ears to approx shoulders\n        ls = { x:(midx-earW*0.9)/w, y: midy/h };\n        rs = { x:(midx+earW*0.9)/w, y: midy/h };\n      }\n      if (!ls || !rs) { alert('Shoulders not found. Ensure your shoulders are visible.'); return; }\n      const sx = (ls.x || 0) * w, sy = (ls.y || 0) * h;\n      const rx = (rs.x || 0) * w, ry = (rs.y || 0) * h;\n      const mx = (sx + rx) / 2, my = (sy + ry) / 2;\n      const shoulderW = Math.max(10, Math.hypot(sx - rx, sy - ry));\n      const base = Math.min(w, h) * 0.6;\n      const desiredOverlayW = shoulderW * 1.8;\n      const scale = Math.max(0.3, Math.min(1.8, desiredOverlayW / Math.max(base, 1)));\n      const angleDeg = (Math.atan2(ry - sy, rx - sx) * 180) / Math.PI;\n      let torsoLen = shoulderW * 1.2;\n      const lh = L[23], rh = L[24];\n      if (lh && rh) {\n        const hx = ((lh.x||0)+(rh.x||0))/2 * w;\n        const hy = ((lh.y||0)+(rh.y||0))/2 * h;\n        torsoLen = Math.max(shoulderW*0.8, Math.hypot(mx - hx, my - hy));\n      }\n      const scaleY = Math.max(0.8, Math.min(1.6, torsoLen / Math.max(shoulderW,1)));\n      // shearY based on shoulder vertical difference before rotation\n      const shoulderDy = (ry - sy);\n      const shearY = Math.max(-0.3, Math.min(0.3, (shoulderDy / Math.max(shoulderW, 1)) * 0.8));\n      const cx = w / 2, cy = h / 2;\n      // Estimate neck Y using nose and ears\n      const nose = L[0];\n      let neckY = my; // fallback: shoulder mid\n      if (nose) {\n        const noseY = (nose.y||0)*h;\n        neckY = Math.min(my - shoulderW*0.15, noseY + shoulderW*0.35);\n      }\n      // convert neck target to overlay offset relative to canvas center\n      const targetY = neckY;\n      // place garment so collar sits near neck target (heuristic offset)\n      const yOffset = (my - targetY) + shoulderW * 0.5;\n      setOverlay((o) => ({ ...o, x: Math.round(mx - cx), y: Math.round(my - cy - yOffset), scale, scaleY, shearY, rotation: Math.round(angleDeg), neckX: mx, neckY: neckY, shoulderW }));\n    } catch (e) {}\n  };\n\n  // Camera handling\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\n        streamRef.current = stream;\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          await videoRef.current.play();\n        }\n        setCanvasSize({ width: constraints.video.width, height: constraints.video.height });\n      } catch (err) {\n        console.error(\"Camera error:\", err);\n        alert(\"Unable to access camera. Please allow permission or use Upload mode.\");\n        setMode(\"upload\");\n      }\n    };\n    const stopCamera = () => {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach((t) => t.stop());\n        streamRef.current = null;\n      }\n    };\n    if (mode === \"camera\") startCamera(); else stopCamera();\n    return () => stopCamera();\n  }, [mode]);\n\n  useEffect(() => {\n    if (window.Pose || window.pose) return;\n    const s = document.createElement(\"script\");\n    s.src = \"https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js\";\n    s.async = true;\n    s.onload = () => {\n      try {\n        const Pose = window.Pose || window.pose;\n        if (!Pose || !Pose.Pose) return;\n        const p = new Pose.Pose({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}` });\n        p.setOptions({ modelComplexity: 0, selfieMode: true, smoothLandmarks: true, enableSegmentation: false });\n        poseRef.current = p;\n        setPoseReady(true);\n      } catch (e) {}\n    };\n    document.body.appendChild(s);\n  }, []);\n\n  // Load MediaPipe Hands to reinforce occlusion for hands/arms\n  useEffect(() => {\n    if (window.Hands || window.hands) return;\n    const s = document.createElement('script');\n    s.src = 'https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js';\n    s.async = true;\n    s.onload = () => {\n      try{\n        const Hands = window.Hands || window.hands;\n        if(!Hands || !Hands.Hands) return;\n        const h = new Hands.Hands({ locateFile: (file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });\n        h.setOptions({ selfieMode: true, maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });\n        handsRef.current = h;\n        setHandsReady(true);\n      }catch(e){}\n    };\n    document.body.appendChild(s);\n  }, []);\n\n  useEffect(() => {\n    if (window.SelfieSegmentation || window.selfieSegmentation) return;\n    const s = document.createElement(\"script\");\n    s.src = \"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js\";\n    s.async = true;\n    s.onload = () => {\n      try {\n        const SS = window.SelfieSegmentation || window.selfieSegmentation;\n        if (!SS || !SS.SelfieSegmentation) return;\n        const seg = new SS.SelfieSegmentation({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}` });\n        seg.setOptions({ modelSelection: 1 }); // landscape general\n        segRef.current = seg;\n        setSegReady(true);\n        setEnableOcclusion(true);\n      } catch (e) {}\n    };\n    document.body.appendChild(s);\n  }, []);\n\n  // File upload -> load as Image\n  const onFileChange = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      const img = new Image();\n      img.onload = () => {\n        setBgImage(img);\n        const maxW = 800, maxH = 800;\n        let w = img.width, h = img.height;\n        const ratio = Math.min(maxW / w, maxH / h, 1);\n        setCanvasSize({ width: Math.round(w * ratio), height: Math.round(h * ratio) });\n      };\n      img.src = reader.result;\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // Capture from camera\n  const captureFromCamera = () => {\n    if (!videoRef.current) return;\n    const { videoWidth: w, videoHeight: h } = videoRef.current;\n    setCanvasSize({ width: w, height: h });\n    const temp = document.createElement(\"canvas\");\n    temp.width = w; temp.height = h;\n    const ctx = temp.getContext(\"2d\");\n    ctx.drawImage(videoRef.current, 0, 0, w, h);\n    const img = new Image();\n    img.onload = () => setBgImage(img);\n    img.src = temp.toDataURL(\"image/png\");\n  };\n\n  // Draw composition with rAF and optional occlusion\n  useEffect(() => {\n    const { width, height } = canvasSize; // for lint dependency clarity\n    const draw = async () => {\n      const canvas = canvasRef.current;\n      const ctx = canvas?.getContext(\"2d\");\n      if (!canvas || !ctx) return;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      // 1) capture background frame\n      let frameCanvas = document.createElement(\"canvas\");\n      frameCanvas.width = canvas.width; frameCanvas.height = canvas.height;\n      const fctx = frameCanvas.getContext(\"2d\");\n      if (bgImage) {\n        const scale = Math.min(canvas.width / bgImage.width, canvas.height / bgImage.height);\n        const drawW = bgImage.width * scale;\n        const drawH = bgImage.height * scale;\n        const offsetX = (canvas.width - drawW) / 2;\n        const offsetY = (canvas.height - drawH) / 2;\n        fctx.drawImage(bgImage, offsetX, offsetY, drawW, drawH);\n        ctx.drawImage(frameCanvas, 0, 0);\n      } else if (mode === \"camera\" && videoRef.current && !videoRef.current.paused) {\n        fctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\n        ctx.drawImage(frameCanvas, 0, 0);\n      } else {\n        ctx.fillStyle = \"#f5f5f5\";\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n      }\n\n      // 2) draw garment overlay (use prepared garment canvas)\n      const productImg = productImgRef.current;\n      if (productImg) {\n        let garment = garmentCanvasRef.current || productImg;\n\n        const baseSize = Math.min(canvas.width, canvas.height) * 0.6;\n        const overlayW = baseSize * (overlay.scale || 1);\n        const aspect = (garment.height || productImg.naturalHeight) / Math.max((garment.width || productImg.naturalWidth),1);\n        const overlayH = overlayW * aspect;\n        const centerX = canvas.width / 2 + overlay.x;\n        const centerY = canvas.height / 2 + overlay.y;\n\n        ctx.save();\n        ctx.translate(centerX, centerY);\n        ctx.rotate((overlay.rotation * Math.PI) / 180);\n        // non-uniform scale and shear to approximate warping\n        const sy = overlay.scaleY || 1;\n        const shy = overlay.shearY || 0; // shear on Y axis\n        const warp = overlay.warp || 0;  // additional piecewise vertical scaling\n        ctx.transform(1, shy, 0, sy, 0, 0);\n        if (warp > 0) {\n          const slices = 24;\n          const srcH = overlayH;\n          for (let i=0;i<slices;i++){\n            const t0 = i / slices;            // 0..1 top->bottom\n            const t1 = (i+1) / slices;\n            const ty = (t0 + t1)/2 - 0.5;     // -0.5..0.5 center\n            const localScale = 1 + warp * (Math.abs(ty)*2 - 0.5); // slightly more scale at chest/hip\n            const sh = (srcH / slices) * localScale;\n            const sy0 = -overlayH/2 + t0*overlayH;\n            const srcY = (t0) * garment.height;\n            const srcSliceH = garment.height / slices;\n            ctx.drawImage(\n              garment,\n              0, srcY, garment.width, srcSliceH,\n              -overlayW/2, sy0, overlayW, sh\n            );\n          }\n        } else {\n          ctx.drawImage(garment, -overlayW / 2, -overlayH / 2, overlayW, overlayH);\n        }\n        // carve a small neck opening so collar doesn't overlay the neck\n        if (overlay.neckX != null && overlay.neckY != null && overlay.shoulderW){\n          ctx.globalCompositeOperation = 'destination-out';\n          const neckLocalX = overlay.neckX - (canvas.width/2 + overlay.x);\n          const neckLocalY = overlay.neckY - (canvas.height/2 + overlay.y);\n          const rx = Math.max(6, overlay.shoulderW*0.22);\n          const ry = Math.max(4, overlay.shoulderW*0.16);\n          ctx.beginPath();\n          ctx.ellipse(neckLocalX, neckLocalY, rx, ry, 0, 0, Math.PI*2);\n          ctx.fill();\n          ctx.globalCompositeOperation = 'source-over';\n        }\n        ctx.restore();\n      }\n\n      // Optional guides\n      if (showGuides) {\n        ctx.strokeStyle = 'rgba(0,0,0,0.2)';\n        ctx.beginPath(); ctx.moveTo(canvas.width/2,0); ctx.lineTo(canvas.width/2,canvas.height); ctx.stroke();\n        ctx.beginPath(); ctx.moveTo(0,canvas.height/2); ctx.lineTo(canvas.width,canvas.height/2); ctx.stroke();\n      }\n\n      // 3) occlusion: draw person foreground on top using mask\n      if (enableOcclusion && segRef.current && (bgImage || mode==='camera')){\n        const seg = segRef.current;\n        let maskImg = null;\n        await new Promise((resolve)=>{\n          seg.onResults((res)=>{ maskImg = res.segmentationMask; resolve(); });\n          seg.send({ image: frameCanvas });\n        });\n        if (maskImg){\n          const personCanvas = document.createElement('canvas');\n          personCanvas.width = canvas.width; personCanvas.height = canvas.height;\n          const pc = personCanvas.getContext('2d');\n          // Grow the mask a bit and blur for softer edges around hands/arms\n          const maskCanvas = document.createElement('canvas');\n          maskCanvas.width = canvas.width; maskCanvas.height = canvas.height;\n          const mc = maskCanvas.getContext('2d');\n          mc.drawImage(maskImg,0,0,canvas.width,canvas.height);\n          // If hands model is ready, paint convex hulls of hands onto the mask\n          if (handsRef.current) {\n            const hands = handsRef.current;\n            let handsData = null;\n            await new Promise((resolve)=>{\n              hands.onResults((res)=>{ handsData = res.multiHandLandmarks || []; resolve(); });\n              hands.send({ image: frameCanvas });\n            });\n            if (handsData && handsData.length) {\n              mc.fillStyle = '#fff';\n              mc.globalAlpha = 1.0;\n              handsData.forEach(points=>{\n                if (!points || points.length===0) return;\n                mc.beginPath();\n                const scaleX = canvas.width, scaleY = canvas.height;\n                points.forEach((p,i)=>{ const x=p.x*scaleX, y=p.y*scaleY; if(i===0) mc.moveTo(x,y); else mc.lineTo(x,y); });\n                mc.closePath();\n                mc.fill();\n              });\n            }\n          }\n          // simple dilation by drawing shifted copies\n          const expanded = document.createElement('canvas');\n          expanded.width = canvas.width; expanded.height = canvas.height;\n          const ex = expanded.getContext('2d');\n          for (const [dx,dy] of [[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]){\n            ex.drawImage(maskCanvas, dx, dy);\n          }\n          ex.filter = 'blur(2px)';\n          ex.drawImage(expanded,0,0);\n          pc.drawImage(frameCanvas,0,0);\n          pc.globalCompositeOperation='destination-in';\n          pc.drawImage(expanded,0,0);\n          pc.globalCompositeOperation='source-over';\n          ctx.drawImage(personCanvas,0,0);\n        }\n      }\n    };\n\n    const loop = () => {\n      if (mode === 'camera') {\n        draw();\n        rafRef.current = requestAnimationFrame(loop);\n      } else {\n        draw();\n      }\n    };\n    loop();\n    return () => { if (rafRef.current) cancelAnimationFrame(rafRef.current); };\n  }, [bgImage, mode, overlay, canvasSize.width, canvasSize.height, enableOcclusion, autoRemoveBg, showGuides]);\n\n  // Live refresh in camera mode\n  useEffect(() => {\n    if (mode !== \"camera\") return;\n    const id = setInterval(() => {\n      const canvas = canvasRef.current;\n      const ctx = canvas?.getContext(\"2d\");\n      if (!canvas || !ctx) return;\n      // redraw\n      const productImg = productImgRef.current;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      if (videoRef.current) {\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\n        if (productImg) {\n          const baseSize = Math.min(canvas.width, canvas.height) * 0.6;\n          const overlayW = baseSize * overlay.scale;\n          const overlayH = overlayW * (productImg.naturalHeight / Math.max(productImg.naturalWidth, 1));\n          const centerX = canvas.width / 2 + overlay.x;\n          const centerY = canvas.height / 2 + overlay.y;\n          ctx.save();\n          ctx.translate(centerX, centerY);\n          ctx.rotate((overlay.rotation * Math.PI) / 180);\n          ctx.drawImage(productImg, -overlayW / 2, -overlayH / 2, overlayW, overlayH);\n          ctx.restore();\n        }\n      }\n    }, 100);\n    return () => clearInterval(id);\n  }, [mode, overlay]);\n\n  const downloadImage = () => {\n    try {\n      const link = document.createElement(\"a\");\n      link.download = `${productName || \"product\"}-tryon.png`;\n      link.href = canvasRef.current.toDataURL(\"image/png\");\n      link.click();\n    } catch (err) {\n      console.error(\"Download failed:\", err);\n      alert(\"Download failed. If product images come from a different domain, enable CORS or use same-origin images.\");\n    }\n  };\n\n  const handleAddToCart = () => {\n    if (!onAddToCart) return;\n    if (isLoggedIn) onAddToCart();\n    else alert(\"Please login to add items to cart.\");\n  };\n\n  return (\n    <div className=\"vto\">\n      <h2>Virtual Try-On</h2>\n\n      <div className=\"vto-mode\">\n        <button className={mode === \"upload\" ? \"active\" : \"\"} onClick={() => setMode(\"upload\")}>\n          Upload Photo\n        </button>\n        <button className={mode === \"camera\" ? \"active\" : \"\"} onClick={() => setMode(\"camera\")}>\n          Use Camera\n        </button>\n      </div>\n\n      <div className=\"vto-stage\">\n        <canvas ref={canvasRef} width={canvasSize.width} height={canvasSize.height} className=\"vto-canvas\" />\n        <img\n          ref={productImgRef}\n          src={productImage}\n          alt={productName}\n          crossOrigin=\"anonymous\"\n          style={{ display: \"none\" }}\n          onLoad={() => { prepareGarmentBitmap(); setOverlay((o) => ({...o})) }}\n        />\n        {/* Optional precomputed mask for the product */}\n        {productMaskImage ? (\n          <img\n            ref={maskImgRef}\n            src={productMaskImage}\n            alt=\"mask\"\n            crossOrigin=\"anonymous\"\n            style={{ display: \"none\" }}\n            onLoad={() => { prepareGarmentBitmap(); setOverlay((o)=>({...o})) }}\n          />\n        ) : null}\n      </div>\n\n      {mode === \"upload\" && (\n        <div className=\"vto-upload\">\n          <input type=\"file\" accept=\"image/*\" onChange={onFileChange} />\n        </div>\n      )}\n\n      {mode === \"camera\" && (\n        <div className=\"vto-camera\">\n          <video ref={videoRef} className=\"vto-video\" playsInline muted />\n          <button onClick={captureFromCamera}>Capture Photo</button>\n        </div>\n      )}\n\n      <div className=\"vto-controls\">\n        <div className=\"ctrl\">\n          <label>Position X</label>\n          <input type=\"range\" min={-canvasSize.width/2} max={canvasSize.width/2} value={overlay.x} onChange={(e)=>setOverlay({...overlay, x:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <label>Position Y</label>\n          <input type=\"range\" min={-canvasSize.height/2} max={canvasSize.height/2} value={overlay.y} onChange={(e)=>setOverlay({...overlay, y:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <label>Scale</label>\n          <input type=\"range\" min={0.2} max={2} step={0.01} value={overlay.scale} onChange={(e)=>setOverlay({...overlay, scale:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <label>Stretch Y</label>\n          <input type=\"range\" min={0.6} max={1.8} step={0.01} value={overlay.scaleY} onChange={(e)=>setOverlay({...overlay, scaleY:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <label>Warp</label>\n          <input type=\"range\" min={0} max={0.4} step={0.005} value={overlay.warp} onChange={(e)=>setOverlay({...overlay, warp:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <label>Rotation</label>\n          <input type=\"range\" min={-180} max={180} value={overlay.rotation} onChange={(e)=>setOverlay({...overlay, rotation:Number(e.target.value)})} />\n        </div>\n        <div className=\"ctrl\">\n          <button disabled={!poseReady} onClick={autoFit}>Auto Fit</button>\n        </div>\n        <div className=\"ctrl\">\n          <label>\n            <input type=\"checkbox\" disabled={!segReady} checked={enableOcclusion && segReady} onChange={(e)=>setEnableOcclusion(e.target.checked)} />\n            Occlusion {segReady ? '' : '(loading...)'}\n          </label>\n        </div>\n        <div className=\"ctrl\">\n          <label><input type=\"checkbox\" checked={autoRemoveBg} onChange={(e)=>setAutoRemoveBg(e.target.checked)} /> Remove garment bg</label>\n        </div>\n        <div className=\"ctrl\">\n          <label><input type=\"checkbox\" checked={showGuides} onChange={(e)=>setShowGuides(e.target.checked)} /> Show guides</label>\n        </div>\n        <div className=\"ctrl\">\n          <label>User height (cm)</label>\n          <input type=\"number\" value={userHeightCm} onChange={(e)=>setUserHeightCm(Number(e.target.value)||170)} style={{ width: 100 }} />\n        </div>\n      </div>\n\n      <div className=\"vto-actions\">\n        <button className=\"btn\" onClick={downloadImage}>Download Result</button>\n        <button className=\"btn primary\" onClick={handleAddToCart}>Add To Cart</button>\n      </div>\n    </div>\n  );\n};\n\nexport default VirtualTryOn;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}